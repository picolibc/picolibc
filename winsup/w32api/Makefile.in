#
#	Makefile.in
#
#	This file is part of a free library for the Win32 API.
# 
#	This library is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

# start config section

SHELL = @SHELL@

srcdir = @srcdir@
VPATH = @srcdir@

target_alias = @target_alias@
prefix = @prefix@

program_transform_name = @program_transform_name@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
tooldir = $(exec_prefix)/$(target_alias)
datadir = @datadir@
infodir = @infodir@
includedir = @includedir@

CC = @CC@
CC_FOR_TARGET = $(CC)
CFLAGS = @CFLAGS@

DLLTOOL = @DLLTOOL@
AS = @AS@
AS_FOR_TARGET = $(AS_FOR_TARGET)
WINDRES = @WINDRES@

RANLIB = @RANLIB@
AR = @AR@
LD = @LD@

TAR = tar

FLAGS_TO_PASS = \
	AS="$(AS)" \
	CC="$(CC)" \
	CPPFLAGS="$(CPPFLAGS)" \
	CFLAGS="$(CFLAGS)" \
	CXXFLAGS="$(CXXFLAGS)" \
	AR="$(AR)" \
	RANLIB="$(RANLIB)" \
	LD="$(LD)" \
	DLLTOOL="$(DLLTOOL)" \
	WINDRES="$(WINDRES)"

# end config section

SUBDIRS = lib

PACKAGE = w32api
VERSION = 0.3

DIST_FILES = Makefile.in configure.in configure config.guess config.sub \
install-sh README ChangeLog TODO

all: lib

%-subdirs:
	for i in $(SUBDIRS); do \
	  $(MAKE) $(FLAGS_TO_PASS) -C $$i $*; \
	done

lib:
	$(MAKE) $(FLAGS_TO_PASS) -C $@

test:
	$(MAKE) -C lib test $(FLAGS_TO_PASS)

install uninstall:
	for i in $(SUBDIRS); do \
		(cd $$i; $(MAKE) $@); \
	done

distdir = $(PACKAGE)-$(VERSION)

dist:
	rm -rf $(distdir)
	mkdir $(distdir)
	chmod 755 $(distdir)
	for i in $(DIST_FILES); do \
		cp -p $(srcdir)/$$i $(distdir)/$$i ; \
	done
	for i in $(SUBDIRS); do \
		(cd $$i; $(MAKE) distdir=../$(distdir) dist); \
	done
	rm -f $(distdir)-src.tar.gz
	$(TAR) czf $(distdir)-src.tar.gz $(distdir)

bindist:
	rm -rf $(distdir)
	mkdir $(distdir)
	chmod 755 $(distdir)
	$(MAKE) install prefix=../$(distdir)
	rm -f $(distdir).tar.gz
	cd $(distdir); $(TAR) czf ../$(distdir).tar.gz .

Makefile: Makefile.in config.status configure
	$(SHELL) config.status

mostlyclean-top:
	rm -f *~
clean-top:
	rm -rf $(distdir)
maintainer-clean-top:

mostlyclean: mostlyclean-top mostlyclean-subdirs
clean: mostlyclean-top clean-subdirs
distclean: clean-top
	rm -f Makefile config.status config.log config.cache TAGS *~
	rm -f include/*~
	rm -f $(distdir)*.tar.gz
	$(MAKE) -C lib distclean
maintainer-clean: maintainer-clean-subdirs

.PHONY: lib test
